<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Socket.IO 테스트</title>
</head>
<body>
    <h1>Socket.IO 클라이언트 테스트</h1>
    <p>브라우저의 개발자 도구(F12) 콘솔을 확인하세요.</p>
    <button onclick="joinRoom()">1번 팀 채팅방 입장</button>

    <!-- Socket.IO 클라이언트 라이브러리 로드 -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        // --- 인증 정보 설정 ---
        // 1. 이 변수에 포스트맨에서 발급받은 실제 JWT 토큰을 붙여넣으세요.
        const myAuthToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsImVtYWlsIjoibW9qYWVAbmF2ZXIuY29tIiwicm9sZSI6IlVTRVIiLCJpYXQiOjE3NTM2Mjc4MzAsImV4cCI6MTc1MzcxNDIzMH0.eec-Lx2yUjeSLbFtBc1VzsIslRhh9uUc1P2R8PtbGGU"; 

        // 2. 서버에 연결할 때, auth 객체를 통해 토큰을 전송합니다.
        const socket = io("http://localhost:3000", {
            auth: {
                token: myAuthToken
            }
        });

        // 3. 서버 연결 성공 시 실행됩니다.
        socket.on("connect", () => {
            console.log("✅ 서버에 연결되었습니다. 소켓 ID:", socket.id);
        });

        // 4. 연결 실패 시 (인증 실패 등) 실행됩니다.
        socket.on("connect_error", (err) => {
            console.error("❌ 연결 실패:", err.message);
        });

        // 5. 서버로부터 'system_message' 이벤트를 받았을 때 실행됩니다.
        socket.on("system_message", (message) => {
            console.log("📢 [서버 시스템 메시지]:", message);
        });
        
        // 6. 서버로부터 'error_message' 이벤트를 받았을 때 실행됩니다.
        socket.on("error_message", (message) => {
            console.error("❌ [서버 에러 메시지]:", message);
        });

        // 7. 서버 연결이 끊어졌을 때 실행됩니다.
        socket.on("disconnect", () => {
            console.log("🔌 서버와의 연결이 끊어졌습니다.");
        });

        // 버튼 클릭 시 'join_room' 이벤트를 서버로 보냅니다.
        function joinRoom() {
            const teamIdToJoin = 1; // 테스트할 팀 ID
            console.log(`🚀 ${teamIdToJoin}번 팀 입장을 요청합니다...`);
            socket.emit("join_room", { teamId: teamIdToJoin });
        }
    </script>
</body>
</html>
